<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safai Mitra - Your Smart Waste Companion</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00796b;
            --primary-light: #e0f2f1;
            --secondary: #ffab40;
            --background: #f0f4f8;
            --surface: #ffffff;
            --text: #1f2937;
            --text-secondary: #6b7280;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--background); }
        .hidden { display: none !important; }

        .progress-bar-fill { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .page { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 10; }
        .confetti { position: absolute; width: 8px; height: 16px; background: #f00; top: -20px; animation: confetti-fall 3s linear infinite; }
        @keyframes confetti-fall {
            0% { transform: translateY(0) rotateZ(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotateZ(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="toastContainer" class="fixed top-5 right-5 z-[100]"></div>

    <div id="loginScreen" class="min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md text-center">
            <i class="fas fa-recycle text-5xl text-teal-600"></i>
            <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">Welcome to Safai Mitra</h2>
            <p class="mt-2 text-center text-sm text-gray-600">Your smart waste companion</p>
        </div>
        <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-white py-8 px-4 shadow-xl sm:rounded-lg sm:px-10">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="aadhaar" class="block text-sm font-medium text-gray-700">Aadhaar Number</label>
                        <div class="mt-1">
                            <input id="aadhaar" name="aadhaar" type="text" placeholder="Enter your 12-digit Aadhaar" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500">Sign In</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <main id="pageContainer" class="pb-24 max-w-4xl mx-auto"></main>
        <nav id="bottomNav" class="fixed bottom-0 inset-x-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] max-w-4xl mx-auto rounded-t-2xl z-20">
            <div class="flex justify-around">
                <a href="#" data-page="home" class="nav-link flex-1 text-center py-3 text-teal-600"><i class="fas fa-home text-xl"></i><span data-translate="nav_home" class="block text-xs font-medium">Home</span></a>
                <a href="#" data-page="history" class="nav-link flex-1 text-center py-3 text-gray-400"><i class="fas fa-history text-xl"></i><span data-translate="nav_history" class="block text-xs font-medium">History</span></a>
                <a href="#" data-page="map" class="nav-link flex-1 text-center py-3 text-gray-400"><i class="fas fa-map-marked-alt text-xl"></i><span data-translate="nav_map" class="block text-xs font-medium">Map</span></a>
                <a href="#" data-page="learn" class="nav-link flex-1 text-center py-3 text-gray-400"><i class="fas fa-book-open text-xl"></i><span data-translate="nav_learn" class="block text-xs font-medium">Learn</span></a>
                <a href="#" data-page="challenges" class="nav-link flex-1 text-center py-3 text-gray-400"><i class="fas fa-trophy text-xl"></i><span data-translate="nav_challenges" class="block text-xs font-medium">Challenges</span></a>
            </div>
        </nav>
    </div>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto relative"></div>
    </div>

    <script>
        class SafaiMitraUserApp {
            constructor() { this.currentUser = null; this.currentPage = 'home'; this.websocket = null; this.websocketSimulator = null; this.map = null; this.data = { binLevels: { organic: 0, recyclable: 0, hazardous: 0 }, disposalHistory: [], rewards: { points: 0, badges: [] }, impact: { co2: 0, landfill: 0 }, feedbackCount: 0 }; this.language = 'en'; this.translations={};}
            async init() { this.setupEventListeners(); await this.loadTranslations(); this.checkSession(); }
            setupEventListeners() {
                document.getElementById('loginForm').addEventListener('submit', (e) => { e.preventDefault(); this.handleLogin(); });
                document.querySelectorAll('.nav-link').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); this.navigateTo(e.currentTarget.dataset.page); }); });
                document.body.addEventListener('click', (e) => { const menu = document.getElementById('profileMenu'); if (menu && !menu.contains(e.target) && !e.target.closest('#profileButton')) { menu.classList.add('hidden'); } });
            }
            async loadTranslations() {
                this.translations = {
                    en: { nav_home: "Home", nav_history: "History", nav_map: "Map", nav_learn: "Learn", nav_challenges: "Challenges", welcome_home: "Welcome Home,", real_time_bins: "Real-time Bin Levels", request_pickup: "Request Pickup", view_disposals: "View Disposals", last_disposal: "Last Disposal", history_title: "Disposal History", map_title: "Nearby Recycling Centers", learn_title: "Learn & Grow", challenges_title: "Challenges & Rewards", organic: "Organic", recyclable: "Recyclable", hazardous: "Hazardous", correct: "Correct", incorrect: "Incorrect", r3_desc: "The cornerstone of sustainable waste management.", zerowaste_desc: "Join the global movement to reduce landfill waste.", composting_desc: "Turn organic waste into nutrient-rich soil.", plastics_desc: "Learn to identify and recycle plastics properly." },
                    hi: { nav_home: "‡§π‡•ã‡§Æ", nav_history: "‡§á‡§§‡§ø‡§π‡§æ‡§∏", nav_map: "‡§®‡§ï‡•ç‡§∂‡§æ", nav_learn: "‡§ú‡§æ‡§®‡•á‡§Ç", nav_challenges: "‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å", welcome_home: "‡§ò‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à,", real_time_bins: "‡§¨‡§ø‡§® ‡§ï‡§æ ‡§∞‡•Ä‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§∏‡•ç‡§§‡§∞", request_pickup: "‡§™‡§ø‡§ï‡§Ö‡§™ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç", view_disposals: "‡§®‡§ø‡§™‡§ü‡§æ‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç", last_disposal: "‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§™‡§ü‡§æ‡§®", history_title: "‡§®‡§ø‡§™‡§ü‡§æ‡§® ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏", map_title: "‡§Ü‡§∏-‡§™‡§æ‡§∏ ‡§ï‡•á ‡§∞‡•Ä‡§∏‡§æ‡§á‡§ï‡•ç‡§≤‡§ø‡§Ç‡§ó ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞", learn_title: "‡§ú‡§æ‡§®‡•á‡§Ç ‡§î‡§∞ ‡§¨‡§¢‡§º‡•á‡§Ç", challenges_title: "‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å ‡§î‡§∞ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞", organic: "‡§ú‡•à‡§µ‡§ø‡§ï", recyclable: "‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø", hazardous: "‡§ñ‡§§‡§∞‡§®‡§æ‡§ï", correct: "‡§∏‡§π‡•Ä", incorrect: "‡§ó‡§≤‡§§", r3_desc: "‡§∏‡§§‡§§ ‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡§æ ‡§Ü‡§ß‡§æ‡§∞‡•§", zerowaste_desc: "‡§≤‡•à‡§Ç‡§°‡§´‡§ø‡§≤ ‡§ï‡§ö‡§∞‡•á ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï ‡§Ü‡§Ç‡§¶‡•ã‡§≤‡§® ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç‡•§", composting_desc: "‡§ú‡•à‡§µ‡§ø‡§ï ‡§ï‡§ö‡§∞‡•á ‡§ï‡•ã ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡§™‡•Ç‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§", plastics_desc: "‡§™‡•ç‡§≤‡§æ‡§∏‡•ç‡§ü‡§ø‡§ï ‡§ï‡•ã ‡§™‡§π‡§ö‡§æ‡§®‡§®‡§æ ‡§î‡§∞ ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§∞‡•Ä‡§∏‡§æ‡§Ø‡§ï‡§≤ ‡§ï‡§∞‡§®‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç‡•§" }
                };
            }
            checkSession() { const user = localStorage.getItem('safaiMitraUser'); if (user) { this.currentUser = JSON.parse(user); document.getElementById('loginScreen').classList.add('hidden'); document.getElementById('mainApp').classList.remove('hidden'); this.loadUserData(); this.navigateTo('home'); this.connectWebSocket(); } }
            handleLogin() { const aadhaar = document.getElementById('aadhaar').value; if (aadhaar === '729966615298') { this.currentUser = { name: "Paneendra", aadhaar: aadhaar, id: "DGPHH001", address: "12B, Nehru Street, City Centre, Durgapur" }; localStorage.setItem('safaiMitraUser', JSON.stringify(this.currentUser)); this.checkSession(); this.showToast('Login Successful!', 'Welcome back.', 'success'); } else { this.showToast('Invalid Aadhaar', 'Please enter the correct number.', 'error'); } }
            handleLogout() { localStorage.removeItem('safaiMitraUser'); localStorage.removeItem(`safaiMitraData_${this.currentUser.id}`); this.currentUser = null; if(this.websocket) this.websocket.close(); clearInterval(this.websocketSimulator); window.location.reload(); }
            loadUserData() { const savedData = localStorage.getItem(`safaiMitraData_${this.currentUser.id}`); this.data = savedData ? JSON.parse(savedData) : { binLevels: { organic: 25, recyclable: 40, hazardous: 10 }, disposalHistory: [], rewards: { points: 1250, badges: ['Eco-Starter'] }, impact: { co2: 15.2, landfill: 22.5 }, feedbackCount: 0 }; if(this.data.disposalHistory.length === 0) { this.seedHistory(); } this.language = localStorage.getItem('safaiMitraLang') || 'en';}
            saveUserData() { localStorage.setItem(`safaiMitraData_${this.currentUser.id}`, JSON.stringify(this.data)); }
            
            navigateTo(page, params = {}) {
                this.currentPage = page; const pageContainer = document.getElementById('pageContainer');
                const isArticle = page === 'learn-article';
                document.getElementById('bottomNav').style.display = isArticle ? 'none' : 'block';
                if (!isArticle) { document.querySelectorAll('.nav-link').forEach(l => { l.classList.toggle('text-teal-600', l.dataset.page === page); l.classList.toggle('text-gray-400', l.dataset.page !== page); }); }
                pageContainer.innerHTML = this.renderPageContent(page, params);
                this.updateUIText();
                if(page === 'map') { requestAnimationFrame(() => this.initializeMap()); }
            }

            renderPageContent(page, params) {
                switch(page) {
                    case 'home': return this.renderHomePage();
                    case 'history': return this.renderHistoryPage();
                    case 'map': return this.renderMapPage();
                    case 'learn': return this.renderLearnPage();
                    case 'learn-article': return this.renderLearnArticlePage(params.topicId);
                    case 'challenges': return this.renderChallengesPage();
                    default: return `<h2>Page not found</h2>`;
                }
            }
            renderHomePage() { const { organic, recyclable, hazardous } = this.data.binLevels; return `<div class="p-4 space-y-6 page"><div class="flex justify-between items-center"><div><p class="text-sm text-gray-500" data-translate="welcome_home">Welcome Home,</p><h1 class="text-2xl font-bold text-gray-800">${this.currentUser.name}</h1></div><div class="relative"><button id="profileButton" onclick="app.toggleProfileMenu()" class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center focus:outline-none ring-2 ring-offset-2 ring-teal-500"><i class="fas fa-user text-2xl text-gray-500"></i></button><div id="profileMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20"><a href="#" onclick="app.openProfileEditor()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit Profile</a><a href="#" onclick="app.openLanguageSelector()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Language</a><a href="#" onclick="app.handleLogout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a></div></div></div><div class="bg-white p-6 rounded-2xl shadow-lg"><h2 class="text-lg font-bold mb-4" data-translate="real_time_bins">Real-time Bin Levels</h2><div class="space-y-4">${this.renderProgressBar('Organic', organic, 'organic')}${this.renderProgressBar('Recyclable', recyclable, 'recyclable')}${this.renderProgressBar('Hazardous', hazardous, 'hazardous')}</div></div><div class="grid grid-cols-2 gap-4"><button onclick="app.requestEarlyPickup()" class="bg-white p-4 rounded-2xl shadow-lg text-center flex flex-col items-center justify-center space-y-2 hover:bg-teal-50 transition"><i class="fas fa-truck text-2xl text-teal-600"></i><span class="font-semibold text-sm" data-translate="request_pickup">Request Pickup</span></button><button onclick="app.navigateTo('history')" class="bg-white p-4 rounded-2xl shadow-lg text-center flex flex-col items-center justify-center space-y-2 hover:bg-teal-50 transition"><i class="fas fa-camera text-2xl text-blue-500"></i><span class="font-semibold text-sm" data-translate="view_disposals">View Disposals</span></button></div><div class="bg-white p-6 rounded-2xl shadow-lg"><h2 class="text-lg font-bold mb-4" data-translate="last_disposal">Last Disposal</h2>${this.renderLastDisposal()}</div></div>`; }
            renderHistoryPage() { return `<div class="p-4 space-y-6 page"><h1 class="text-2xl font-bold text-gray-800" data-translate="history_title">Disposal History</h1><div id="history-list" class="space-y-4">${this.data.disposalHistory.length > 0 ? this.data.disposalHistory.map(item => this.renderHistoryItem(item)).join('') : '<p class="text-center text-gray-500 mt-8">No disposal history yet.</p>'}</div></div>`; }
            renderMapPage() { return `<div class="p-4 space-y-6 page"><h1 class="text-2xl font-bold text-gray-800" data-translate="map_title">Nearby Recycling Centers</h1><div id="map" class="h-[70vh] w-full rounded-2xl shadow-lg z-0"></div></div>`; }
            renderLearnPage() { return `<div class="p-4 space-y-6 page"><h1 class="text-2xl font-bold text-gray-800" data-translate="learn_title">Learn & Grow</h1>${this.renderLearnCard(this.getLearnTopic('r3').title, 'r3_desc', 'fa-recycle', 'bg-green-100 text-green-600', 'r3')}${this.renderLearnCard(this.getLearnTopic('zerowaste').title, 'zerowaste_desc', 'fa-calendar-check', 'bg-blue-100 text-blue-600', 'zerowaste')}${this.renderLearnCard(this.getLearnTopic('composting').title, 'composting_desc', 'fa-leaf', 'bg-yellow-100 text-yellow-600', 'composting')}${this.renderLearnCard(this.getLearnTopic('plastics').title, 'plastics_desc', 'fa-bottle-water', 'bg-purple-100 text-purple-600', 'plastics')}</div>`; }
            renderLearnArticlePage(topicId) { const topic = this.getLearnTopic(topicId); const content = topic.content[this.language] || topic.content.en; const title = topic.title[this.language] || topic.title.en; return `<div class="page"><div class="p-4"><button onclick="app.navigateTo('learn')" class="font-semibold text-teal-600 mb-4"><i class="fas fa-arrow-left mr-2"></i>Back</button></div><img src="${topic.image}" alt="${title}" class="w-full h-48 object-cover"><div class="p-6 bg-white space-y-4"><h1 class="text-2xl font-bold">${title}</h1>${content}</div></div>`; }
            renderChallengesPage() { const c=[{t:"Recycle Right!",d:"Correctly sort 15 recyclable items.",p:this.data.disposalHistory.filter(i=>i.type.en.includes('RECYCLABLE')).length,l:15,i:"fa-recycle",c:"blue"},{t:"Organic Champion",d:"Dispose of 10 organic items.",p:this.data.disposalHistory.filter(i=>i.type.en.includes('ORGANIC')).length,l:10,i:"fa-leaf",c:"green"},{t:"Feedback Pro",d:"Submit feedback on 20 classifications.",p:this.data.feedbackCount||0,l:20,i:"fa-check-double",c:"purple"}, {t:"Point Collector",d:"Earn 1,500 points.",p:this.data.rewards.points,l:1500,i:"fa-star",c:"yellow"}],l=[{n:"The Sharma Family",p:1280},{n:"The Singh Residence",p:950},{n:"You",p:this.data.rewards.points}].sort((a,b)=>b.p-a.p); return `<div class="p-4 space-y-6 page"><h1 class="text-2xl font-bold text-gray-800" data-translate="challenges_title">Challenges & Rewards</h1><div class="bg-white p-6 rounded-2xl shadow-lg"><div class="flex items-center justify-between bg-yellow-100 p-4 rounded-lg mb-6"><div class="flex items-center space-x-2"><i class="fas fa-star text-2xl text-yellow-500"></i><span class="font-bold text-xl">${this.data.rewards.points.toLocaleString()}</span><span class="text-sm text-yellow-700">Points</span></div><button class="text-sm font-semibold text-yellow-800">Redeem</button></div><h3 class="text-lg font-bold mb-4">Weekly Challenges</h3><div class="space-y-4">${c.map(c=>`<div><div class="flex items-center space-x-3 mb-2"><i class="fas ${c.i} text-${c.c}-500"></i><h4 class="font-semibold">${c.t}</h4></div><p class="text-xs text-gray-500 mb-2">${c.d}</p><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-${c.c}-500 h-2.5 rounded-full" style="width: ${Math.min(100, (c.p/c.l)*100)}%"></div></div></div>`).join('')}</div></div><div class="bg-white p-6 rounded-2xl shadow-lg"><h3 class="text-lg font-bold mb-4">Community Leaderboard</h3><ul class="space-y-3">${l.map((u,i)=>`<li class="flex items-center justify-between p-3 rounded-lg ${u.n==='You'?'bg-teal-50 border-2 border-teal-200':''}"><div class="flex items-center space-x-3"><span class="font-bold w-6">${i+1}.</span><span class="${u.n==='You'?'font-bold':''}">${u.n}</span></div><span class="font-bold text-teal-600">${u.p.toLocaleString()} pts</span></li>`).join('')}</ul></div></div>`; }
            renderProgressBar(l,v,t) { const c={organic:'bg-green-500',recyclable:'bg-blue-500',hazardous:'bg-red-500'},i={organic:'fa-leaf',recyclable:'fa-recycle',hazardous:'fa-biohazard'}; return `<div><div class="flex justify-between items-center mb-1"><span class="font-semibold text-sm flex items-center"><i class="fas ${i[t]} mr-2 text-gray-500"></i><span data-translate="${t}">${l}</span></span><span class="font-bold text-sm ${v>90?'text-red-600 animate-pulse':''}">${v}% Full</span></div><div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden"><div class="progress-bar-fill h-4 rounded-full ${c[t]}" style="width: ${v}%"></div></div></div>`; }
            renderLastDisposal() { const l=this.data.disposalHistory[0]; if(!l)return `<p class="text-center text-gray-500">No disposals yet.</p>`; const tc={ORGANIC:'text-green-600',RECYCLABLE:'text-blue-600',HAZARDOUS:'text-red-600'}; const typeText = l.type[this.language] || l.type.en; return `<div class="flex items-center space-x-4"><img src="${l.photoUrl}" alt="${typeText}" class="w-20 h-20 rounded-lg object-cover bg-gray-100"><div><p class="font-bold text-lg ${tc[l.type.en.split(' (')[0]]||'text-gray-800'}">${typeText}</p><p class="text-sm text-gray-500">${this.formatTimeAgo(l.timestamp)}</p></div></div>`; }
            renderHistoryItem(i) { const tc={ORGANIC:'border-green-500',RECYCLABLE:'border-blue-500',HAZARDOUS:'border-red-500'}; let feedbackContent; const typeText = i.type[this.language] || i.type.en; if (i.feedbackGiven) { feedbackContent = `<p class="text-xs text-gray-500 mt-2 italic"><i class="fas fa-check-circle text-green-500 mr-1"></i>Thanks for your feedback!</p>`; } else { feedbackContent = `<div class="mt-2 text-xs space-x-2"><button onclick="app.submitFeedback(${i.id},true)" class="font-semibold text-green-600 hover:text-green-800"><i class="fas fa-check"></i> <span data-translate="correct">Correct</span></button><button onclick="app.submitFeedback(${i.id},false)" class="font-semibold text-red-600 hover:text-red-800"><i class="fas fa-times"></i> <span data-translate="incorrect">Incorrect</span></button></div>`; } return `<div class="bg-white p-4 rounded-2xl shadow-lg flex items-center space-x-4 border-l-4 ${tc[i.type.en.split(' (')[0]]||'border-gray-500'}"><img src="${i.photoUrl}" alt="${typeText}" class="w-24 h-24 rounded-lg object-cover bg-gray-100"><div><p class="font-bold text-lg">${typeText}</p><p class="text-sm text-gray-500">${this.formatTimeAgo(i.timestamp)}</p>${feedbackContent}</div></div>`; }
            renderLearnCard(t,dKey,i,c,id) { return `<div class="bg-white p-6 rounded-2xl shadow-lg flex items-start space-x-4 cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-transform" onclick="app.navigateTo('learn-article', { topicId: '${id}' })"><div class="w-12 h-12 rounded-lg flex-shrink-0 flex items-center justify-center ${c}"><i class="fas ${i} text-2xl"></i></div><div><h3 class="font-bold text-lg mb-1">${t[this.language]||t.en}</h3><p data-translate="${dKey}" class="text-sm text-gray-600"></p></div></div>`; }
            toggleProfileMenu() { document.getElementById('profileMenu').classList.toggle('hidden'); }
            openProfileEditor() { this.toggleProfileMenu(); this.showModal({ title: 'Edit Profile', body: `<div><label for="familyName" class="block text-sm font-medium text-gray-700">Household Name</label><input type="text" id="familyName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm" value="${this.currentUser.name}"></div><div><label for="address" class="mt-4 block text-sm font-medium text-gray-700">Address</label><input type="text" id="address" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm" value="${this.currentUser.address}"></div>`, footer: `<button onclick="app.closeModal()" class="px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button><button onclick="app.saveProfile()" class="px-4 py-2 text-sm text-white bg-teal-600 rounded-md hover:bg-teal-700">Save</button>` }); }
            openLanguageSelector() { this.toggleProfileMenu(); this.showModal({ title: 'Select Language', body: `<div class="grid grid-cols-2 gap-4"><button onclick="app.setLanguage('en')" class="p-4 bg-gray-100 font-semibold rounded-lg hover:bg-gray-200">English</button><button onclick="app.setLanguage('hi')" class="p-4 bg-gray-100 font-semibold rounded-lg hover:bg-gray-200">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</button></div>`, footer: '' });}
            setLanguage(lang) { this.language = lang; localStorage.setItem('safaiMitraLang', lang); this.closeModal(); this.navigateTo(this.currentPage); this.showToast('Language Updated!', lang === 'hi' ? '‡§≠‡§æ‡§∑‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§' : 'Language has been updated.', 'success'); }
            updateUIText() { document.querySelectorAll('[data-translate]').forEach(el => { const key = el.dataset.translate; if (this.translations[this.language] && this.translations[this.language][key]) { el.textContent = this.translations[this.language][key]; } }); }
            saveProfile() { const n=document.getElementById('familyName').value.trim(); const a=document.getElementById('address').value.trim(); if(n&&a){this.currentUser.name=n; this.currentUser.address=a; localStorage.setItem('safaiMitraUser',JSON.stringify(this.currentUser)); this.closeModal(); this.navigateTo('home'); this.showToast('Profile Updated!', 'Your details have been changed.', 'success');}else{this.showToast('Invalid Input','All fields are required.','error');} }
            getLearnTopic(topicId) { const topics = { 'r3': { title: {en:'The 3 R\'s', hi:'3 R ‡§ï‡§æ ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§'}, image: 'https://images.unsplash.com/photo-1591129392051-034ff717c6b5?q=80&w=1200&auto=format&fit=crop', content: { en: `<h3 class="text-xl font-bold mb-2">Foundation of Sustainable Living</h3><p class="mb-4">This simple principle is the most effective way to minimize your environmental impact. Here‚Äôs a breakdown:</p><ul class="space-y-4 text-sm"><li><strong class="text-green-600">REDUCE:</strong> The best way to manage waste is to not create it. Think about purchases and packaging.</li><li><strong class="text-blue-600">REUSE:</strong> Give items a second life. Glass jars become storage, old t-shirts become cleaning rags.</li><li><strong class="text-yellow-600">RECYCLE:</strong> This converts waste into new materials, saving energy and resources.</li></ul>`, hi: `<h3 class="text-xl font-bold mb-2">‡§∏‡§§‡§§ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡§æ ‡§Ü‡§ß‡§æ‡§∞</h3><p class="mb-4">‡§Ø‡§π ‡§∏‡§∞‡§≤ ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§ ‡§Ü‡§™‡§ï‡•á ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£‡•Ä‡§Ø ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π‡§æ‡§Å ‡§è‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§π‡•à:</p><ul class="space-y-4 text-sm"><li><strong class="text-green-600">‡§ï‡§Æ ‡§ï‡§∞‡•á‡§Ç (REDUCE):</strong> ‡§ï‡§ö‡§∞‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø ‡§á‡§∏‡•á ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§π‡•Ä ‡§® ‡§ú‡§æ‡§è‡•§</li><li><strong class="text-blue-600">‡§™‡•Å‡§®: ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç (REUSE):</strong> ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§ú‡•Ä‡§µ‡§® ‡§¶‡•á‡§Ç‡•§ ‡§ï‡§æ‡§Ç‡§ö ‡§ï‡•á ‡§ú‡§æ‡§∞ ‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§¨‡§® ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç, ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ü‡•Ä-‡§∂‡§∞‡•ç‡§ü ‡§∏‡§´‡§æ‡§à ‡§ï‡•á ‡§ï‡§™‡§°‡§º‡•á ‡§¨‡§® ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§</li><li><strong class="text-yellow-600">‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç (RECYCLE):</strong> ‡§Ø‡§π ‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ï‡•ã ‡§®‡§à ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§î‡§∞ ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§¨‡§ö‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§</li></ul>` } }, 'zerowaste': { title: {en:'Zero Waste Lifestyle', hi:'‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ú‡•Ä‡§µ‡§® ‡§∂‡•à‡§≤‡•Ä'}, image: 'https://images.unsplash.com/photo-1542601906-8b2363228724?q=80&w=1200&auto=format&fit=crop', content: { en: `<h3 class="text-xl font-bold mb-2">A Goal for a Cleaner Planet</h3><p class="mb-4">Zero Waste is a philosophy to send nothing to a landfill. Here are some simple swaps:</p><ul class="space-y-3 list-disc list-inside"><li>Carry a reusable water bottle and coffee cup.</li><li>Bring your own cloth bags to the grocery store.</li><li>Switch to bar soap instead of liquid soap in plastic bottles.</li></ul>`, hi: `<h3 class="text-xl font-bold mb-2">‡§è‡§ï ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ ‡§ó‡•ç‡§∞‡§π ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø</h3><p class="mb-4">‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§è‡§ï ‡§¶‡§∞‡•ç‡§∂‡§® ‡§π‡•à ‡§ú‡•ã ‡§≤‡•à‡§Ç‡§°‡§´‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π‡§æ‡§Å ‡§ï‡•Å‡§õ ‡§∏‡§∞‡§≤ ‡§â‡§™‡§æ‡§Ø ‡§¶‡§ø‡§è ‡§ó‡§è ‡§π‡•à‡§Ç:</p><ul class="space-y-3 list-disc list-inside"><li>‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ú‡•ç‡§Ø ‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§¨‡•ã‡§§‡§≤ ‡§î‡§∞ ‡§ï‡•â‡§´‡•Ä ‡§ï‡§™ ‡§∏‡§æ‡§• ‡§∞‡§ñ‡•á‡§Ç‡•§</li><li>‡§ï‡§ø‡§∞‡§æ‡§®‡•á ‡§ï‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§® ‡§™‡§∞ ‡§Ö‡§™‡§®‡•á ‡§ñ‡•Å‡§¶ ‡§ï‡•á ‡§ï‡§™‡§°‡§º‡•á ‡§ï‡•á ‡§¨‡•à‡§ó ‡§≤‡§æ‡§è‡§Å‡•§</li><li>‡§™‡•ç‡§≤‡§æ‡§∏‡•ç‡§ü‡§ø‡§ï ‡§ï‡•Ä ‡§¨‡•ã‡§§‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§∏‡§æ‡§¨‡•Å‡§® ‡§ï‡•Ä ‡§ü‡§ø‡§ï‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§</li></ul>` } }, 'composting': { title: {en:'Composting at Home', hi:'‡§ò‡§∞ ‡§™‡§∞ ‡§ï‡§Æ‡•ç‡§™‡•ã‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó'}, image: 'https://images.unsplash.com/photo-1606842843939-a9121d582845?q=80&w=1200&auto=format&fit=crop', content: { en: `<h3 class="text-xl font-bold mb-2">Nature's Recycling Program</h3><p class="mb-4">Composting turns your kitchen scraps into "black gold" for your garden.</p><ul class="space-y-4 text-sm"><li><strong class="text-green-600">"Greens" (Nitrogen):</strong> Fruit/vegetable scraps, coffee grounds, grass clippings.</li><li><strong class="text-yellow-800">"Browns" (Carbon):</strong> Dried leaves, cardboard, newspaper.</li><li><strong>The Ratio:</strong> Aim for 3 parts browns to 1 part greens.</li><li><strong>Avoid:</strong> Meat, dairy, oily foods, and pet waste.</li></ul>`, hi: `<h3 class="text-xl font-bold mb-2">‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø ‡§ï‡§æ ‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</h3><p class="mb-4">‡§ï‡§Æ‡•ç‡§™‡•ã‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§Ü‡§™‡§ï‡•á ‡§∞‡§∏‡•ã‡§à ‡§ï‡•á ‡§ï‡§ö‡§∞‡•á ‡§ï‡•ã ‡§Ü‡§™‡§ï‡•á ‡§¨‡§ó‡•Ä‡§ö‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "‡§ï‡§æ‡§≤‡§æ ‡§∏‡•ã‡§®‡§æ" ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§</p><ul class="space-y-4 text-sm"><li><strong class="text-green-600">"‡§π‡§∞‡§æ" (‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§®):</strong> ‡§´‡§≤/‡§∏‡§¨‡•ç‡§ú‡•Ä ‡§ï‡•á ‡§õ‡§ø‡§≤‡§ï‡•á, ‡§ï‡•â‡§´‡•Ä ‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§°, ‡§ò‡§æ‡§∏ ‡§ï‡•Ä ‡§ï‡§§‡§∞‡§®‡•á‡§Ç‡•§</li><li><strong class="text-yellow-800">"‡§≠‡•Ç‡§∞‡§æ" (‡§ï‡§æ‡§∞‡•ç‡§¨‡§®):</strong> ‡§∏‡•Ç‡§ñ‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç, ‡§ï‡§æ‡§∞‡•ç‡§°‡§¨‡•ã‡§∞‡•ç‡§°, ‡§Ö‡§ñ‡§¨‡§æ‡§∞‡•§</li><li><strong>‡§Ö‡§®‡•Å‡§™‡§æ‡§§:</strong> ‡§≤‡§ó‡§≠‡§ó 3 ‡§≠‡§æ‡§ó ‡§≠‡•Ç‡§∞‡§æ ‡§î‡§∞ 1 ‡§≠‡§æ‡§ó ‡§π‡§∞‡§æ ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§£ ‡§∞‡§ñ‡•á‡§Ç‡•§</li><li><strong>‡§¨‡§ö‡•á‡§Ç:</strong> ‡§Æ‡§æ‡§Ç‡§∏, ‡§°‡•á‡§Ø‡§∞‡•Ä, ‡§§‡•á‡§≤‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§≠‡•ã‡§ú‡§® ‡§î‡§∞ ‡§™‡§æ‡§≤‡§§‡•Ç ‡§ú‡§æ‡§®‡§µ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§ï‡§ö‡§∞‡•á ‡§∏‡•á‡•§</li></ul>` } }, 'plastics': { title: {en:'Understanding Plastics', hi:'‡§™‡•ç‡§≤‡§æ‡§∏‡•ç‡§ü‡§ø‡§ï ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡§æ'}, image: 'https://images.unsplash.com/photo-1622635955148-3a525e68345c?q=80&w=1200&auto=format&fit=crop', content: { en: `<h3 class="text-xl font-bold mb-2">Decoding the Numbers</h3><p class="mb-4">Check the number inside the recycling symbol:</p><ul class="space-y-4 text-sm"><li><strong class="text-blue-600">#1 (PETE) & #2 (HDPE):</strong> Water/soda bottles, milk jugs. Commonly recycled.</li><li><strong class="text-green-600">#5 (PP):</strong> Yogurt containers, tubs. Increasingly recyclable.</li><li><strong>Others (#3, #4, #6, #7):</strong> Often difficult to recycle. Check locally.</li></ul>`, hi: `<h3 class="text-xl font-bold mb-2">‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡§æ</h3><p class="mb-4">‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç:</p><ul class="space-y-4 text-sm"><li><strong class="text-blue-600">#1 (PETE) & #2 (HDPE):</strong> ‡§™‡§æ‡§®‡•Ä/‡§∏‡•ã‡§°‡§æ ‡§ï‡•Ä ‡§¨‡•ã‡§§‡§≤‡•á‡§Ç, ‡§¶‡•Ç‡§ß ‡§ï‡•á ‡§ú‡§ó‡•§ ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§™‡•Å‡§®‡§∞‡•ç‡§®‡§µ‡•Ä‡§®‡•Ä‡§ï‡§∞‡§£‡•§</li><li><strong class="text-green-600">#5 (PP):</strong> ‡§¶‡§π‡•Ä ‡§ï‡•á ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞, ‡§ü‡§¨‡•§ ‡§§‡•á‡§ú‡•Ä ‡§∏‡•á ‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£‡•Ä‡§Ø‡•§</li><li><strong>‡§Ö‡§®‡•ç‡§Ø (#3, #4, #6, #7):</strong> ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§ï‡§∞‡§®‡§æ ‡§Æ‡•Å‡§∂‡•ç‡§ï‡§ø‡§≤ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§</li></ul>` } }}; return topics[topicId] || { title: {en:"Not Found", hi:"‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ"}, content: {en:"Details are not available.", hi:"‡§µ‡§ø‡§µ‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§"} }; }
            requestEarlyPickup() { this.showModal({ title: 'Request Early Pickup', body: `<p class="text-sm text-gray-600">Are you sure you want to notify municipal authorities? Use this only if bins are nearly full.</p>`, footer: `<button onclick="app.closeModal()" class="px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button><button onclick="app.confirmEarlyPickup()" class="px-4 py-2 text-sm text-white bg-teal-600 rounded-md hover:bg-teal-700">Confirm</button>` }); }
            confirmEarlyPickup() { this.closeModal(); this.showToast('Request Sent!', 'Authorities have been notified.', 'success'); }
            submitFeedback(itemId, isCorrect) { const item = this.data.disposalHistory.find(i => i.id === itemId); if(item.feedbackGiven) return; this.data.feedbackCount = (this.data.feedbackCount || 0) + 1; item.feedbackGiven = true; this.saveUserData(); this.navigateTo('history'); if (isCorrect) { this.showToast('Feedback Submitted', 'Thank you for helping us improve!', 'success'); } else { this.showModal({ title: 'Correct Misclassification', body: `<p class="mb-4">Please select the correct category.</p><div class="grid grid-cols-3 gap-4"><button onclick="app.confirmFeedbackCorrection()" class="p-4 bg-green-100 text-green-700 font-semibold rounded-lg hover:bg-green-200">Organic</button><button onclick="app.confirmFeedbackCorrection()" class="p-4 bg-blue-100 text-blue-700 font-semibold rounded-lg hover:bg-blue-200">Recyclable</button><button onclick="app.confirmFeedbackCorrection()" class="p-4 bg-red-100 text-red-700 font-semibold rounded-lg hover:bg-red-200">Hazardous</button></div>`, footer: `` }); } this.checkAndAwardBadges(); }
            confirmFeedbackCorrection() { this.closeModal(); this.data.rewards.points += 5; this.saveUserData(); this.showToast('Correction Submitted', `+5 points for training our model!`, 'success'); if(this.currentPage === 'challenges') this.navigateTo('challenges'); }
            connectWebSocket() { this.showToast('Connecting to Smart Bin...', '', 'info'); this.startWebSocketSimulator(); }
            seedHistory() { const items = [ {t:{en:'ORGANIC (Apple Core)',hi:'‡§ú‡•à‡§µ‡§ø‡§ï (‡§∏‡•á‡§¨ ‡§ï‡§æ ‡§ï‡•ã‡§∞)',key:'apple_core'}, p:'https://placehold.co/400x400/4CAF50/FFFFFF?text=Apple+Core'}, {t:{en:'RECYCLABLE (Bottle)',hi:'‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø (‡§¨‡•ã‡§§‡§≤)',key:'bottle'}, p:'https://placehold.co/400x400/2196F3/FFFFFF?text=Plastic+Bottle'}, {t:{en:'ORGANIC (Peels)',hi:'‡§ú‡•à‡§µ‡§ø‡§ï (‡§õ‡§ø‡§≤‡§ï‡•á)',key:'peels'}, p:'https://placehold.co/400x400/8BC34A/FFFFFF?text=Vegetable+Peels'}, {t:{en:'RECYCLABLE (Box)',hi:'‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø (‡§¨‡•â‡§ï‡•ç‡§∏)',key:'box'}, p:'https://placehold.co/400x400/03A9F4/FFFFFF?text=Cardboard+Box'}, {t:{en:'HAZARDOUS (Battery)',hi:'‡§ñ‡§§‡§∞‡§®‡§æ‡§ï (‡§¨‡•à‡§ü‡§∞‡•Ä)',key:'battery'}, p:'https://placehold.co/400x400/E91E63/FFFFFF?text=Battery'}, {t:{en:'RECYCLABLE (Jar)',hi:'‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø (‡§ú‡§æ‡§∞)',key:'jar'}, p:'https://placehold.co/400x400/9C27B0/FFFFFF?text=Glass+Jar'}, {t:{en:'ORGANIC (Shells)',hi:'‡§ú‡•à‡§µ‡§ø‡§ï (‡§Ö‡§Ç‡§°‡•á ‡§ï‡•á ‡§õ‡§ø‡§≤‡§ï‡•á)',key:'shells'}, p:'https://placehold.co/400x400/CDDC39/FFFFFF?text=Egg+Shells'}, {t:{en:'RECYCLABLE (Can)',hi:'‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø (‡§ï‡•à‡§®)',key:'can'}, p:'https://placehold.co/400x400/00BCD4/FFFFFF?text=Aluminum+Can'}, {t:{en:'ORGANIC (Coffee)',hi:'‡§ú‡•à‡§µ‡§ø‡§ï (‡§ï‡•â‡§´‡•Ä)',key:'coffee'}, p:'https://placehold.co/400x400/FFC107/FFFFFF?text=Coffee+Grounds'}, {t:{en:'HAZARDOUS (Bulb)',hi:'‡§ñ‡§§‡§∞‡§®‡§æ‡§ï (‡§¨‡§≤‡•ç‡§¨)',key:'bulb'}, p:'https://placehold.co/400x400/F44336/FFFFFF?text=Light+Bulb'} ]; this.data.disposalHistory = items.map((item, i) => ({ id: Date.now() - (i * 360000), type: item.t, photoUrl: item.p, timestamp: new Date(Date.now() - (i * 360000)).toISOString() })); }
            startWebSocketSimulator() { const items=[{t:{en:'ORGANIC (Apple Core)', hi:'‡§ú‡•à‡§µ‡§ø‡§ï (‡§∏‡•á‡§¨ ‡§ï‡§æ ‡§ï‡•ã‡§∞)', key:'apple_core'},p:'https://placehold.co/400x400/4CAF50/FFFFFF?text=Apple+Core'},{t:{en:'RECYCLABLE (Bottle)', hi:'‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§Ø‡•ã‡§ó‡•ç‡§Ø (‡§¨‡•ã‡§§‡§≤)', key:'bottle'},p:'https://placehold.co/400x400/2196F3/FFFFFF?text=Plastic+Bottle'}]; this.websocketSimulator = setInterval(() => { this.handleWebSocketMessage(JSON.stringify({ type: 'bin_update', levels: { organic: Math.min(100, this.data.binLevels.organic + 1), recyclable: Math.min(100, this.data.binLevels.recyclable + 2), hazardous: Math.min(100, this.data.binLevels.hazardous + 1) } })); if (Math.random() > 0.8) { const randomItem = items[Math.floor(Math.random()*items.length)]; this.handleWebSocketMessage(JSON.stringify({ type: 'new_disposal', item: { id: Date.now(), type: randomItem.t, photoUrl: randomItem.p, timestamp: new Date().toISOString() } })); } }, 4000); }
            handleWebSocketMessage(data) { try { const msg = JSON.parse(data); if (msg.type === 'bin_update') { this.data.binLevels = msg.levels; Object.entries(msg.levels).forEach(([t, l]) => { if (l > 95 && (this.lastAlertLevel?.[t] || 0) <= 95) { this.showToast(`${t.charAt(0).toUpperCase()+t.slice(1)} bin almost full!`, 'Authorities notified.', 'warning'); } }); this.lastAlertLevel = msg.levels; } else if (msg.type === 'new_disposal') { this.data.disposalHistory.unshift(msg.item); this.data.rewards.points += 10; this.data.impact.co2 += 0.1; this.data.impact.landfill += 0.2; this.showToast('New Item Disposed!', `+10 points for sorting.`, 'success'); this.checkAndAwardBadges(); } this.saveUserData(); if (['home', 'history', 'challenges'].includes(this.currentPage)) this.navigateTo(this.currentPage); } catch (e) { console.error("WS Error:", e); } }
            checkAndAwardBadges() { const badges = [ { name: 'Feedback Pro', condition: () => this.data.feedbackCount >= 20 }, { name: 'Point Collector', condition: () => this.data.rewards.points >= 1500 } ]; badges.forEach(badge => { if (!this.data.rewards.badges.includes(badge.name) && badge.condition()) { this.data.rewards.badges.push(badge.name); this.saveUserData(); this.showBadgeUnlockModal(badge.name); } }); }
            showBadgeUnlockModal(badgeName) { this.showModal({ title: 'üéâ Badge Unlocked! üéâ', body: `<div class="text-center"><div class="confetti-container"></div><i class="fas fa-medal text-6xl text-yellow-400 my-4"></i><h3 class="text-xl font-bold">You've earned the "${badgeName}" badge!</h3><p class="mt-2 text-gray-600">Keep up the great work!</p></div>`, footer: `<button onclick="app.closeModal()" class="w-full px-4 py-2 text-sm font-medium text-white bg-teal-600 rounded-md hover:bg-teal-700">Awesome!</button>` }); this.launchConfetti(); }
            launchConfetti() { const container = document.querySelector('#modal-content'); const colors = ['#f44336', '#2196f3', '#4caf50', '#ffeb3b', '#9c27b0']; for (let i = 0; i < 50; i++) { const confetti = document.createElement('div'); confetti.className = 'confetti'; confetti.style.left = `${Math.random() * 100}%`; confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; confetti.style.animationDelay = `${Math.random() * 3}s`; container.appendChild(confetti); } }
            initializeMap() { if (this.map) { this.map.invalidateSize(); return; } setTimeout(() => { this.map = L.map('map').setView([23.54, 87.31], 13); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.map); [{ n: 'DGP Recyclers', lt: 23.535, lg: 87.315, ty: 'All Materials' }, { n: 'City Centre E-Waste', lt: 23.545, lg: 87.305, ty: 'Electronics' }, { n: 'Benachity Paper Mill', lt: 23.528, lg: 87.335, ty: 'Paper/Cardboard' }].forEach(c => L.marker([c.lt, c.lg]).addTo(this.map).bindPopup(`<b>${c.n}</b><br>${c.ty}`)); }, 100); }
            formatTimeAgo(iso) { const s = Math.floor((new Date() - new Date(iso)) / 1000); let i = s / 86400; if (i > 1) return Math.floor(i) + "d ago"; i = s / 3600; if (i > 1) return Math.floor(i) + "h ago"; i = s / 60; if (i > 1) return Math.floor(i) + "m ago"; return Math.floor(s) + "s ago"; }
            showToast(title, msg, type = 'info') { const i={s:'fa-check-circle',e:'fa-times-circle',w:'fa-exclamation-triangle',i:'fa-info-circle'},c={s:'green',e:'red',w:'yellow',i:'blue'},t=document.createElement('div'); t.className=`w-80 bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden`; t.innerHTML=`<div class="p-4"><div class="flex items-start"><div class="flex-shrink-0"><i class="fas ${i[type.slice(0,1)]} text-${c[type.slice(0,1)]}-500"></i></div><div class="ml-3 w-0 flex-1 pt-0.5"><p class="text-sm font-medium text-gray-900">${title}</p><p class="mt-1 text-sm text-gray-500">${msg}</p></div></div></div>`; document.getElementById('toastContainer').appendChild(t); setTimeout(()=>t.remove(),5000); }
            showModal({title, body, footer}) { document.getElementById('modal-content').innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">${title}</h3><button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button></div><div class="text-sm text-gray-600 leading-relaxed">${body}</div><div class="mt-6 flex justify-end space-x-3">${footer}</div>`; const m=document.getElementById('modal-container'); m.classList.remove('hidden'); m.classList.add('flex'); }
            closeModal() { const m=document.getElementById('modal-container'); m.classList.add('hidden'); m.classList.remove('flex'); }
        }
        document.addEventListener('DOMContentLoaded', () => { window.app = new SafaiMitraUserApp(); window.app.init(); });
    </script>
</body>
</html>

